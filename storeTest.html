<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CryptoZombies front-end</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script language="javascript" type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/storeABI.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script language="javascript" type="text/javascript" src="./src/js/bootstrap.bundle.min.js"></script>
</head>

<body>

<div id="snakes"></div>

<button onclick="storeNumber()">Click me</button>

<script>
    const cryptoSnakesAddress = "0x2cc8919Ac5f4bf32C0Cc2F2480d5e7B495f10Ae0";
    let cryptoSnakes;

    let account;

    const startApp = async () => {

        await web3.eth.getAccounts(function(err, accounts) {
            if (err != null) {
                alert("Error retrieving accounts.");
                return;
            }
            if (accounts.length == 0) {
                alert("No account found! Make sure the Ethereum client is configured properly.");
                return;
            }
            account = accounts[0];
            console.log('Account: ' + account);
            web3.eth.defaultAccount = account;
        });

        const userID = await web3.eth.net.getId();
        console.log("User-ID: " + userID)

        cryptoSnakes = await new web3.eth.Contract(snakeCreatorABI, cryptoSnakesAddress);
        console.log(cryptoSnakes)


        cryptoSnakes.methods.storenumber(22).send( {from: account}).then( tx => console.log(tx))

        const rec = await cryptoSnakes.methods.retreive().call()
        console.log(rec)
        console.log("END")

    }

    function storeNumber(){
        cryptoSnakes.methods.storenumber(22).send( {from: account}).then( tx => console.log(tx))
    }

    window.addEventListener('load', function () {
        if (typeof web3 !== 'undefined') {
            console.log("Web3 is found")
            console.log(web3.version);

            web3 = new Web3(window.ethereum);
            window.ethereum.enable();

            console.log(web3.version);
        } else {
            console.log("Web3 is NOT found !!!")
        }
        startApp()

    })
</script>
</body>
</html>